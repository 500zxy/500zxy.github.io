!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):n.jsApi=e()}(this,function(){"use strict";var n=navigator.userAgent,e={versions:{trident:-1<n.indexOf("Trident"),presto:-1<n.indexOf("Presto"),webKit:-1<n.indexOf("AppleWebKit"),gecko:-1<n.indexOf("Gecko")&&-1===n.indexOf("KHTML"),mobile:!!n.match(/AppleWebKit.*Mobile.*/),ios:!!n.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:-1<n.indexOf("Android")||-1<n.indexOf("Linux"),iPhone:-1<n.indexOf("iPhone"),iPad:-1<n.indexOf("iPad"),webApp:-1===n.indexOf("Safari")},language:(navigator.browserLanguage||navigator.language).toLowerCase()};function r(){var n=window.sessionStorage.getItem("jsSession"),o={msg:"",status:""};return new Promise(function(i,t){void 0!==n&&""!==n&&null!==n||(o.status=-1,o.msg="未登录",t(o)),window.WebViewJavascriptBridge.callHandler("authCheckApp",{session:n},function(n){var e=n;"string"==typeof n&&(e=JSON.parse(n)),0===e.status?(o.status=0,o.msg="认证成功",i(o)):(o.stutas=e.status,o.msg=e.msg,t(o))})})}function i(n,e){return new Promise(function(i,t){r().then(function(){window.WebViewJavascriptBridge.callHandler(n,e,function(n){var e=n;"string"==typeof e&&(e=JSON.parse(e)),0===e.status?i(e):t(e)})}).catch(function(n){t(n)})})}var t={login:function(n){return new Promise(function(i,t){!function(n){if(window.WebViewJavascriptBridge)return n(window.WebViewJavascriptBridge);if(window.WVJBCallbacks)return window.WVJBCallbacks.push(n);window.WVJBCallbacks=[n];var e=document.createElement("iframe");e.style.display="none",e.src="wvjbscheme://__BRIDGE_LOADED__",document.documentElement.appendChild(e),setTimeout(function(){document.documentElement.removeChild(e)},0)}(function(){window.WebViewJavascriptBridge.callHandler("login",{appKey:n.appKey},function(n){var e=n;"string"==typeof e&&(e=JSON.parse(e)),0===e.status?(sessionStorage.setItem("jsSession",e.result.session),i(e)):t(e)})})})},getGPS:function(){return new Promise(function(i,t){r().then(function(){window.WebViewJavascriptBridge.callHandler("getGPS",null,function(n){var e=n;"string"==typeof e&&(e=JSON.parse(e)),0===e.status?i(e):t(e)})}).catch(function(n){t(n)})})},getUserInfo:function(){return new Promise(function(i,t){r().then(function(){window.WebViewJavascriptBridge.callHandler("getUserInfor",null,function(n){var e=n;"string"==typeof e&&(e=JSON.parse(e)),0===e.status?i(e):t(e)})}).catch(function(n){t(n)})})},scanQRcode:function(){return new Promise(function(i,t){r().then(function(){window.WebViewJavascriptBridge.callHandler("scanQRcode",null,function(n){var e=n;"string"==typeof e&&(e=JSON.parse(e)),0===e.status?i(e):t(e)})}).catch(function(n){t(n)})})},alert:function(n){return new Promise(function(i,t){r().then(function(){window.WebViewJavascriptBridge.callHandler("alert",{message:n.message,title:n.title,btnName:n.btnName},function(n){var e=n;"string"==typeof e&&(e=JSON.parse(e)),0===e.status?i(e):t(e)})}).catch(function(n){t(n)})})},confirm:function(o){return new Promise(function(t,e){r().then(function(){window.WebViewJavascriptBridge.callHandler("confirm",{message:o.message,title:o.title,btnName:o.btnName},function(n){var e=n;"string"==typeof e&&(e=JSON.parse(e)),t(e);var i=e.result.clickIndex;o.btn[i]()})}).catch(function(n){e(n)})})},singleShake:function(){r().then(function(){window.WebViewJavascriptBridge.callHandler("singleShake",{},function(n){})})},showProgress:function(){r().then(function(){window.WebViewJavascriptBridge.callHandler("showProgress",{},function(n){})})},hiddenProgress:function(){r().then(function(){window.WebViewJavascriptBridge.callHandler("hiddenProgress",{},function(n){})})},hiddenNavigation:function(){r().then(function(){window.WebViewJavascriptBridge.callHandler("hiddenNavigation",{},function(n){})})},showNavigation:function(){r().then(function(){window.WebViewJavascriptBridge.callHandler("showNavigation",{},function(n){})})},closeWebView:function(){r().then(function(){window.WebViewJavascriptBridge.callHandler("closeWebView",{},function(n){})}).catch(function(n){Promise.reject(n)})},webViewReset:function(){r().then(function(){window.WebViewJavascriptBridge.callHandler("webViewReset",{},function(n){})})},modifyNavigationTitle:function(n){r().then(function(){window.WebViewJavascriptBridge.callHandler("webViewReset",{title:n.title},function(n){})})},createTribe:function(n){return new Promise(function(i,t){r().then(function(){window.WebViewJavascriptBridge.callHandler("createTribe",{tribeName:n.tribeName,tribeNotice:n.tribeNotice},function(n){var e=n;"string"==typeof e&&(e=JSON.parse(e)),0===e.status?i(e):t(e)})}).catch(function(n){t(n)})})},joinToTribe:function(n){return i("joinToTribe",n)},openTribe:function(n){return i("openTribe",n)},noticeBroad:function(n){return new Promise(function(i,t){r().then(function(){window.WebViewJavascriptBridge.callHandler("noticeBroad",{noticeName:n.noticeName},function(n){var e=n;"string"==typeof e&&(e=JSON.parse(e)),0===e.status?i(e):t(e)})}).catch(function(n){t(n)})})},openPerson:function(n){return i("openPerson",n)},openPersonWithKey:function(n){return i("openPersonWithKey",n)},shakeOneShake:function(){return new Promise(function(i){window.WebViewJavascriptBridge.registerHandler("shakeOneShake",function(n,e){e({status:0}),i(n)})})},saveImage:function(n){return new Promise(function(i,t){r().then(function(){window.WebViewJavascriptBridge.callHandler("saveImage",{imageUrl:n.imageUrl},function(n){var e=n;"string"==typeof e&&(e=JSON.parse(e)),0===e.status?i(e):t(e)})}).catch(function(n){t(n)})})},needBackAction:function(){return new Promise(function(e){window.WebViewJavascriptBridge.callHandler("needBackAction",{},function(n){e(n)})})},giveBackAction:function(){return new Promise(function(i){window.WebViewJavascriptBridge.registerHandler("giveBackAction",function(n,e){e({status:0}),i(n)})})},makePhoneCall:function(n){return new Promise(function(i,t){r().then(function(){window.WebViewJavascriptBridge.callHandler("makePhoneCall",{tel:n.tel},function(n){var e=n;"string"==typeof e&&(e=JSON.parse(e)),0===e.status?i(e):t(e)})}).catch(function(n){t(n)})})},requestMethod:function(n){return new Promise(function(i,e){r().then(function(){window.WebViewJavascriptBridge.callHandler("requestMethod",{method:n.method,requestData:n.requestData,requestUrl:n.requestUrl},function(n){var e=n;"string"==typeof e&&(e=JSON.parse(e)),i(e)})}).catch(function(n){e(n)})})},openNewWebView:function(n){r().then(function(){window.WebViewJavascriptBridge.callHandler("openNewWebView",{url:n.url,title:n.title,hiddenNavigation:n.hiddenNavigation},function(n){})})},cutWebView:function(){return new Promise(function(i,t){r().then(function(){window.WebViewJavascriptBridge.callHandler("cutWebView",{},function(n){var e=n;"string"==typeof e&&(e=JSON.parse(e)),0===e.status?i(e):t(e)})}).catch(function(n){t(n)})})}};return new function n(){!function(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),this.browser=e,Object.assign(this,t)}});
